---
description: 测试设计与测试执行的通用规则（适用于本仓库所有业务与测试代码）
globs:
  - "**/*"
alwaysApply: true
---
# 测试设计与测试执行

## 目的
确保测试真实覆盖业务功能，促进设计演进的同时保持代码与文档的最新与整洁，杜绝“为通过测试而写、不服务最终业务”的代码。

## 适用范围
- 本仓库所有业务代码（packages/*）与测试代码（tests/*、scripts/*）。
- 相关文档与测试数据（例如 tests/units/works/mock-io）。

## 核心原则
- 业务代码不包含测试相关逻辑（除非绝对必要的临时钩子，且在合并前移除）。
- 测试必须覆盖真实业务功能与接口行为，不得以“造假数据”或“绕过逻辑”方式获取通过。
- 当设计/功能发生变更，关联的已删除或废弃的测试用例与测试代码必须同步删除。
- 历史沿袭仅通过 git 历史回溯；最新版文档与代码只反映当前状态，禁止通过改名文件或备份目录保留旧版本。
- 坚决禁止单纯为“通过测试”而编写、且不覆盖最终业务功能的代码进入最新版目录树。

## 要求与规范
### 代码隔离
- 测试代码集中在 tests/* 与相关脚本目录；业务包内不得引入测试依赖或测试专用逻辑。
- 运行时（production/dev）不加载测试专用模块或数据。

### 变更与清理
- 当接口或行为更新，需同步更新或删除不再适用的测试用例、测试数据与脚本。
- 不保留“备份/改名”式文件；使用 git 历史进行回溯。

## 实施与检查（PR 准入清单）
- 不存在测试逻辑出现在 packages/*/src 等业务源码路径。
- 与当前设计一致：删除/更新废弃测试与数据；无备份/改名文件残留。
- 测试通过且覆盖目标达到。
- 不引入明文密钥；mock 使用 DEVMINDS_MOCK_DIR 等既有机制。

## 例外处理
- 如确需在业务代码中临时加入测试钩子（绝对必要场景），必须：
  - 明确标注为临时（带注释说明原因与移除条件）；
  - 仅限短期本地验证；
  - 在合并主干前全部移除。

## 术语说明
- “测试相关代码”：仅为测试而存在、生产运行不需的逻辑、依赖或分支。
- “废弃测试”：覆盖已删除或被替换的功能/接口的测试与其数据。

---

目标：以真实业务覆盖为核心，保持最新、简洁和可回溯的代码与文档，避免任何与最终业务价值无关的测试代码残留。
